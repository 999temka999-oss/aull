{% extends "base.html" %}
{% block title %}–ê–∫–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω{% endblock %}
{% block content %}
<main class="container" style="padding: 20px; text-align: center; background: #ffebee; min-height: 100vh;">
    <div style="max-width: 500px; margin: 50px auto; padding: 30px; background: #f44336; color: white; border-radius: 10px; box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3);">
        <h1 style="font-size: 2em; margin-bottom: 20px;">üö´ –ê–∫–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</h1>
        
        <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 8px; margin: 20px 0;">
            <h2 style="font-size: 1.2em; margin-bottom: 10px;">–ü—Ä–∏—á–∏–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:</h2>
            <p id="blockReason" style="font-size: 1.1em; font-weight: bold;">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
        </div>
        
        <div style="margin-top: 30px; font-size: 0.9em; opacity: 0.9;">
            <p>–ï—Å–ª–∏ —Å—á–∏—Ç–∞–µ—Ç–µ, —á—Ç–æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –ø–æ –æ—à–∏–±–∫–µ,<br>–æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.</p>
        </div>
        
        <div style="margin-top: 30px;">
            <button onclick="checkStatus()" style="padding: 12px 24px; background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); border-radius: 6px; cursor: pointer; font-size: 1em;">
                üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
            </button>
        </div>
    </div>
</main>

<script>
let blockReason = "–ê–∫–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º";

// –ü–æ–ª—É—á–∞–µ–º –ø—Ä–∏—á–∏–Ω—É –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏–∑ sessionStorage
const playerData = sessionStorage.getItem("blocked_reason");
if (playerData) {
    blockReason = playerData;
}

document.getElementById("blockReason").textContent = blockReason;

async function checkStatus() {
    const btn = document.querySelector("button");
    const originalText = btn.textContent;
    btn.disabled = true;
    btn.textContent = "üîÑ –ü—Ä–æ–≤–µ—Ä—è–µ–º...";
    
    try {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ API —Å–æ—Å—Ç–æ—è–Ω–∏—è
        const response = await fetch('/api/state', {
            credentials: 'same-origin'
        });
        
        const data = await response.json();
        
        if (data.ok) {
            // –ï—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ - –∑–Ω–∞—á–∏—Ç —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏
            sessionStorage.removeItem("blocked_reason");
            window.location.href = "/farm";
        } else if (data.error === "user_blocked") {
            // –í—Å–µ –µ—â–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
            document.getElementById("blockReason").textContent = data.blocked_reason || blockReason;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            const notification = document.createElement("div");
            notification.style.cssText = "position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.8); color: white; padding: 15px 25px; border-radius: 5px; z-index: 9999;";
            notification.textContent = "‚ùå –ê–∫–∫–∞—É–Ω—Ç –≤—Å–µ –µ—â–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω";
            document.body.appendChild(notification);
            
            setTimeout(() => notification.remove(), 3000);
        } else {
            // –î—Ä—É–≥–∞—è –æ—à–∏–±–∫–∞
            window.location.href = "/";
        }
    } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞:", error);
    }
    
    btn.disabled = false;
    btn.textContent = originalText;
}
</script>
{% endblock %}